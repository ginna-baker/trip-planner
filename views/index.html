{% extends "layout.html" %}

{% block content %}

 <div class="row">
    <div class="col-md-3" id="daysContainer">
      <button type="button" class="btn btn-success" id="dayBtn">+ Add Day</button>
    </div>


    <div class="col-md-3">
          <h3>Hotels</h3>
          <select id="h-select" class="form-control">
          <button type="button" class="btn btn-default dropdown-toggle btn-lg" data-toggle="dropdown">
            <span class="caret"></span>
            <span class="sr-only">Toggle Dropdown</span>
          </button>
          </select>
          <ul class="dropdown-menu" role="menu">

          </ul>
          <button type="button" class="btn btn-primary" id="hAdd">Add</button>
    </div>

    <div class="col-md-3">
          <h3>Things to Do</h3>
          <select id="t-select" class="form-control">
          <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
            <span class="caret"></span>
            <span class="sr-only">Toggle Dropdown</span>
          </button>
          </select>
          <ul class="dropdown-menu" role="menu">

          </ul>
          <button type="button" class="btn btn-primary" id="ttdAdd">Add</button>
    </div>

    <div class="col-md-3">
            <h3>Restaurants</h3>
            <select id="r-select" class="form-control">
            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
              <span class="caret"></span>
              <span class="sr-only">Toggle Dropdown</span>
            </button>
            </select>
            <ul class="dropdown-menu" role="menu">
        <!--       //how to get things here// -->
            </ul>
            <button type="button" class="btn btn-primary" id= "restAdd">Add</button>
        </div>

  </div><!-- end row -->

  <div class="row">
    <div class="col-md-3" id="day-panel"><h3>Plan</h3>
        <ul id="itin">
        </ul>
    </div>
    <div class="col-md-9" id="map-canvas"><h3>Map</h3></div>
  </div>

{% endblock %}

{% block js %}
<script>

{% autoescape false %}
var data = {
  hotels: {{ hotels | json}},
  thingstodo: {{ thingsToDo | json}},
  restaurants: {{ restaurants | json}}
};
{% endautoescape %}

var selectors = {
    hotels: $("#h-select"),
    thingstodo: $("#t-select"),
    restaurants: $("#r-select")
  }

  var days = [];
  var currentDay;
  var $daysContainer = $("#daysContainer");
  var $dayPanel = $('#day-panel');

  var addDay = function() {
    var dayObj = {
      number:days.length+1,
      hotels:[],
      restaurants:[],
      thingsToDo:[]
    };

    days.push(dayObj);
    $daysContainer.append("<button data-num= '" + dayObj.number + "' class='btn btn-success' id='days" + dayObj.number + "'>Day " + dayObj.number + "</button>");
    $("#dayBtn" + dayObj.number).on('click',function() {
      $(this).addClass('active');
      var dataNum = $(this).attr('data-num');
      var day = days[dataNum-1];
      // $dayPanel.html(JSON.stringify(day));
      currentDay = day;
      rerender(day);
    })
  }

  addDay();

  $("#dayBtn").on('click',function() {
    addDay();
  })


//make add activities work
  $('#hadd').on('click', function(){
    $('#itin').append("<li data-num= " + currentDay.number + ">"  + "</li>");
    currentDay.hotels.push(selectors.hotels.val());
  })

// currentDay.hotels = data.hotels[]

// get hotel Latlng, used further below
var hotelNum = function () {
for (var i=0; i<15; i++) {
  if (data.hotels[i]=currentDay.hotels) {
  return i}
}
}

// latlng = data.hotels[hotelNum].place.location[num1, num2];

var rerender = function (day){

//may need to refine.  See Zeke's code
  $('#daypanel').push(currentDay[place]);
  $('#map-canvas').initialize_gmaps();
//google maps load, show arrows for location lat and lon
}

  var initSelectors = function() {
    var optionFactory = function(obj) {
      return "<option value='" + obj._id + "'>" + obj.name + "</option>";
    };

    var selectAppender = function($select,obj) {
      $select.append(optionFactory(obj))
    };

    for(var type in data) {
      if(data.hasOwnProperty(type)) {
        console.log(data[type])
        data[type].forEach(function(obj) {
          selectAppender(selectors[type],obj);
        })
      }
    }
  };

initSelectors();

function initialize_gmaps() {

  // initialize new google maps LatLng object
  var myLatlng = new google.maps.LatLng(40.705786,-74.007672);

  // set the map options hash
  var mapOptions = {
    center: myLatlng,
    zoom: 16,
    mapTypeId: google.maps.MapTypeId.ROADMAP
  };

  // get the maps div's HTML obj
  var map_canvas_obj = document.getElementById("map-canvas");

  // initialize a new Google Map with the options
  var map = new google.maps.Map(map_canvas_obj, mapOptions);

  // Add the marker to the map
  var marker = new google.maps.Marker({
    position: Latlng,
    title:"Look here"
  });

  // Add the marker to the map by calling setMap()
  marker.setMap(map);
}

$(document).ready(function() {
  initialize_gmaps();
});

</script>
{% endblock %}

